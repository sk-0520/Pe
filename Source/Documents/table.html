<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>いーあーる</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <textarea id="define">
# テーブル一覧

___

## AppSystems

### layout

| PK | NN | FK | 論理カラム名 |     物理カラム名      | 論理データ型 | 実データ型 |  マッピング型   | チェック制約 | コメント |
|:--:|:--:|:---|:-------------|:----------------------|:-------------|:-----------|:----------------|:-------------|:---------|
| o  | o  |    |              | Key                   | text         | text       | System.String   |              |          |
|    | o  |    |              | CreatedTimestamp      | datetime     | text       | System.DateTime |              | UTC      |
|    | o  |    |              | CreatedAccount        | text         | text       | System.String   |              |          |
|    | o  |    |              | CreatedProgramName    | text         | text       | System.String   |              |          |
|    | o  |    |              | CreatedProgramVersion | text         | text       | System.Version  |              |          |
|    | o  |    |              | UpdatedTimestamp      | datetime     | text       | System.DateTime |              | UTC      |
|    | o  |    |              | UpdatedAccount        | text         | text       | System.String   |              |          |
|    | o  |    |              | UpdatedProgramName    | text         | text       | System.String   |              |          |
|    | o  |    |              | UpdatedProgramVersion | text         | text       | System.Version  |              |          |
|    | o  |    |              | UpdatedCount          | integer      | integer    | System.Int64    |              |          |
|    | o  |    |              | Value                 | text         | text       | System.String   |              |          |
|    | o  |    |              | Note                  | text         | text       | System.String   |              |          |

### index

*NONE*


___

## LauncherItems

### layout

| PK | NN | FK | 論理カラム名 |       物理カラム名       | 論理データ型 | 実データ型 |  マッピング型   | チェック制約 | コメント |
|:--:|:--:|:---|:-------------|:-------------------------|:-------------|:-----------|:----------------|:-------------|:---------|
| o  | o  |    |              | LauncherItemId           | text         | text       | System.Guid     |              |          |
|    | o  |    |              | CreatedTimestamp         | datetime     | text       | System.DateTime |              | UTC      |
|    | o  |    |              | CreatedAccount           | text         | text       | System.String   |              |          |
|    | o  |    |              | CreatedProgramName       | text         | text       | System.String   |              |          |
|    | o  |    |              | CreatedProgramVersion    | text         | text       | System.Version  |              |          |
|    | o  |    |              | UpdatedTimestamp         | datetime     | text       | System.DateTime |              | UTC      |
|    | o  |    |              | UpdatedAccount           | text         | text       | System.String   |              |          |
|    | o  |    |              | UpdatedProgramName       | text         | text       | System.String   |              |          |
|    | o  |    |              | UpdatedProgramVersion    | text         | text       | System.Version  |              |          |
|    | o  |    |              | UpdatedCount             | integer      | integer    | System.Int64    |              |          |
|    | o  |    |              | Code                     | text         | text       | System.String   |              |          |
|    | o  |    |              | Name                     | text         | text       | System.String   |              |          |
|    | o  |    |              | Kind                     | text         | text       | System.String   |              |          |
|    | o  |    |              | IconPath                 | text         | text       | System.String   |              |          |
|    | o  |    |              | IconIndex                | integer      | integer    | System.Int64    |              |          |
|    | o  |    |              | IsEnabledCommandLauncher | boolean      | integer    | System.Int64    |              |          |
|    | o  |    |              | ExecuteCount             | integer      | integer    | System.Int64    |              |          |
|    | o  |    |              | LastExecuteTimestamp     | datetime     | text       | System.DateTime |              | UTC      |
|    | o  |    |              | Note                     | text         | text       | System.String   |              |          |

### index

| UK | カラム(CSV) |
|:--:|:------------|
| o  | Code        |



    </textarea>

    <div id="view"></div>

    <script>

        var regTable  = /^##\s*(.+)\s*/;

        function getIndex(lines) {
            var regLayout = /^###\s*layout\s*/;
            var regIndex  = /^###\s*index\s*/;

            var state_table  =  0;
            var state_layout = 10;
            var state_index  = 20;

            var state = state_table;

            var lineIndex = {
                table: -1,
                layout: {
                    head: -1,
                    tail: -1
                },
                index: {
                    head: -1,
                    tail: -1
                }
            };

            for(var i = 0; i < lines.length; i++) {
                var line = lines[i];

                switch(state) {
                    case state_table:
                        if(regTable.test(line)) {
                            lineIndex.table = i;
                            state = state_layout;
                        }
                        break;

                    case state_layout:
                        if(regLayout.test(line)) {
                            lineIndex.layout.head = i + 1;
                            state = state_index;
                        }
                        break;
                        
                    case state_index:
                        if(regIndex.test(line)) {
                            lineIndex.layout.tail = i;
                            lineIndex.index.head = i + 1;
                            lineIndex.index.tail = lines.length;
                            return lineIndex;
                        }
                        break;
                 
                    default:
                        throw 'こねーよ！';
                }
            }

            return lineIndex;
        }

        function trimDefines(rawDefines) {
            var result = {
                table: null
            };

            var match = rawDefines.table.match(regTable);
            result.table = match[1];

            return result;
        }

        function splitDefine(tableDefine) {
            var lines = tableDefine.split(/\r?\n/mg);
            var index = getIndex(lines);

            var rawDefines = {
                table: lines[index.table],
                layout: lines.slice(index.layout.head, index.layout.tail),
                index: lines.slice(index.index.head, index.index.tail)
            };
            var trimedDefines = trimDefines(rawDefines);
            
            alert(JSON.stringify(trimedDefines));

        }

        function buildTableDefine(tableDefine) {
            var defines = splitDefine(tableDefine);
            var rootElement = document.createElement('div');
            return rootElement;
        }

        function build() {
            var defineElement = document.getElementById('define');
            var defineValue = defineElement.value;

            var viewElement = document.getElementById('view');

            var tableDefines = defineValue.split('___');
            tableDefines.shift();

            for(var tableDefine of tableDefines) {
                var tableBlockElement = buildTableDefine(tableDefine);
                viewElement.appendChild(tableBlockElement);
            }
        }

        build();


    </script>
</body>

</html>