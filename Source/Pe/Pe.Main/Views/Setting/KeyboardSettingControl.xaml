<UserControl
  x:Name="root"
  x:Class="ContentTypeTextNet.Pe.Main.Views.Setting.KeyboardSettingControl"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"

  xmlns:app_core_views_converter="clr-namespace:ContentTypeTextNet.Pe.Core.Views.Converter;assembly=Pe.Core"
  xmlns:app_main_views_setting="clr-namespace:ContentTypeTextNet.Pe.Main.Views.Setting"
  xmlns:app_main_viewmodels_setting="clr-namespace:ContentTypeTextNet.Pe.Main.ViewModels.Setting"
  xmlns:app_main="clr-namespace:ContentTypeTextNet.Pe.Main"
  xmlns:app_main_views="clr-namespace:ContentTypeTextNet.Pe.Main.Views"
  xmlns:app_main_views_converter="clr-namespace:ContentTypeTextNet.Pe.Main.Views.Converter"
  xmlns:app_main_modes_data="clr-namespace:ContentTypeTextNet.Pe.Main.Models.Data"

  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  mc:Ignorable="d"
  d:DesignWidth="800"
  d:DesignHeight="450"
>
  <UserControl.Resources>
    <app_core_views_converter:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
    <app_main_views_converter:EnumToCultureConverter x:Key="EnumToCultureConverter" />

    <Style x:Key="ExpanderHeaderInner" TargetType="FrameworkElement">
      <Setter Property="HorizontalAlignment" Value="{Binding HorizontalAlignment, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ContentPresenter}}, Mode=OneWayToSource}" />
      <Setter Property="VerticalAlignment" Value="Center" />
    </Style>
  </UserControl.Resources>
  <Grid>
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*" />
      <ColumnDefinition Width="Auto" />
      <ColumnDefinition Width="*" />
      <ColumnDefinition Width="Auto" />
      <ColumnDefinition Width="*" />
    </Grid.ColumnDefinitions>

    <Grid Grid.Column="0">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <ToolBar Grid.Row="0" Style="{StaticResource DefaultHorizontal-Toolbar}">
        <Label  Content="{Binding Resources.String_Setting_Keyboard_Replace_Header, Source={x:Static app_main:CultureService.Current}}" />
        <Button Content="{Binding Resources.String_Setting_Keyboard_Replace_Add_A, Source={x:Static app_main:CultureService.Current}}" Command="{Binding Editor.AddReplaceJobCommand, ElementName=root}" />
      </ToolBar>

      <ScrollViewer Grid.Row="1">
        <ItemsControl ItemsSource="{Binding Editor.ReplaceJobEditors, ElementName=root}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Grid>
                <Expander>
                  <Expander.Header>
                    <Grid Style="{StaticResource ExpanderHeaderInner}">
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>

                      <app_main_views_setting:KeyInputControl Grid.Row="0" Grid.Column="0" KeyItemsSource="{Binding Editor.ReplaceKeyItems, ElementName=root}" Key="{Binding SourceKey}" IsVisibleModifierKey="False" />
                      <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Resources.String_Setting_Keyboard_Replace_To, Source={x:Static app_main:CultureService.Current}}" />
                      <app_main_views_setting:KeyInputControl Grid.Row="0" Grid.Column="2" KeyItemsSource="{Binding Editor.ReplaceKeyItems, ElementName=root}" Key="{Binding ReplaceKey}" IsVisibleModifierKey="False" />
                    </Grid>
                  </Expander.Header>
                  <Expander.Content>
                    <StackPanel>
                      <TextBox Text="{Binding Comment}" />
                      <Button Content="x" Command="{Binding Editor.RemoveReplaceJobCommand, ElementName=root}" CommandParameter="{Binding}" />
                    </StackPanel>
                  </Expander.Content>
                </Expander>
              </Grid>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>

    <GridSplitter Grid.Column="1" Style="{StaticResource DefaultVericalGridSplitter}" />

    <Grid Grid.Column="2">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <ToolBar Grid.Row="0" Style="{StaticResource DefaultHorizontal-Toolbar}">
        <Label  Content="{Binding Resources.String_Setting_Keyboard_Ignore_Header, Source={x:Static app_main:CultureService.Current}}" />
        <Button Content="{Binding Resources.String_Setting_Keyboard_Ignore_Add_A, Source={x:Static app_main:CultureService.Current}}" Command="{Binding Editor.AddDisableJobCommand, ElementName=root}" />
      </ToolBar>

      <ScrollViewer Grid.Row="1">
        <ItemsControl ItemsSource="{Binding Editor.DisableJobEditors, ElementName=root}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Grid>
                <Expander>
                  <Expander.Header>
                    <app_main_views_setting:KeyInputControl Grid.Row="0" Grid.Column="0"  Style="{StaticResource ExpanderHeaderInner}" KeyItemsSource="{Binding Editor.DisableKeyItems, ElementName=root}" Key="{Binding Key}" IsVisibleModifierKey="False" />
                  </Expander.Header>
                  <Expander.Content>
                    <StackPanel>
                      <CheckBox Grid.Column="1" Content="{Binding Resources.String_Setting_Keyboard_Pressed_Forever_A, Source={x:Static app_main:CultureService.Current}}" IsChecked="{Binding Forever}" />
                      <TextBox Text="{Binding Comment}" />
                      <Button Content="x" Command="{Binding Editor.RemoveDisableJobCommand, ElementName=root}" CommandParameter="{Binding}" />
                    </StackPanel>
                  </Expander.Content>
                </Expander>
              </Grid>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>

    <GridSplitter Grid.Column="3" Style="{StaticResource DefaultVericalGridSplitter}" />

    <Grid Grid.Column="4">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto" />
        <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <ToolBar Grid.Row="0" Style="{StaticResource DefaultHorizontal-Toolbar}">
        <Label  Content="{Binding Resources.String_Setting_Keyboard_Pressed_Header, Source={x:Static app_main:CultureService.Current}}" />
        <Grid>
          <ToggleButton x:Name="switchCreateJob" IsChecked="{Binding Editor.IsPopupCreateJobMenu, ElementName=root}" Content="{Binding Resources.String_Setting_Keyboard_Pressed_Add_A, Source={x:Static app_main:CultureService.Current}}" />
          <Popup Style="{StaticResource PopupMenu}" IsOpen="{Binding IsChecked, ElementName=switchCreateJob}">
            <Border Style="{StaticResource PopupMenuBorder}">
              <StackPanel>
                <MenuItem Header="{Binding Resources.String_Setting_Keyboard_Pressed_Add_Command_A, Source={x:Static app_main:CultureService.Current}}" Command="{Binding Editor.AddCommandJobCommand, ElementName=root}" />
                <MenuItem Header="{Binding Resources.String_Setting_Keyboard_Pressed_Add_LauncherItem_A, Source={x:Static app_main:CultureService.Current}}" Command="{Binding Editor.AddLauncherItemJobCommand, ElementName=root}" />
                <MenuItem Header="{Binding Resources.String_Setting_Keyboard_Pressed_Add_Toolbar_A, Source={x:Static app_main:CultureService.Current}}" Command="{Binding Editor.AddLauncherToolbarJobCommand, ElementName=root}" />
                <MenuItem Header="{Binding Resources.String_Setting_Keyboard_Pressed_Add_Note_A, Source={x:Static app_main:CultureService.Current}}" Command="{Binding Editor.AddNoteJobCommand, ElementName=root}" />

              </StackPanel>
            </Border>
          </Popup>
        </Grid>
      </ToolBar>

      <ScrollViewer Grid.Row="1">
        <ItemsControl ItemsSource="{Binding Editor.PressedJobEditors, ElementName=root}">
          <ItemsControl.Resources>
            <StackPanel x:Key="Mappings" x:Shared="False">
              <ItemsControl ItemsSource="{Binding MappingItems}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate>
                    <Grid>
                      <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                      </Grid.ColumnDefinitions>

                      <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                          <RowDefinition Height="*" />
                          <RowDefinition Height="Auto" />
                          <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <Button Grid.Row="0" Content="up" Command="{Binding DataContext.UpMappingCommand, ElementName=item}" CommandParameter="{Binding}" />
                        <Button Grid.Row="1" Content="x" Command="{Binding DataContext.RemoveMappingCommand, ElementName=item}" CommandParameter="{Binding}" />
                        <Button Grid.Row="2" Content="down" Command="{Binding DataContext.DownMappingCommand, ElementName=item}" CommandParameter="{Binding}" />
                      </Grid>

                      <app_main_views_setting:KeyInputControl Grid.Column="1" KeyItemsSource="{Binding Editor.PressedKeyItems, ElementName=root}" Key="{Binding Key}" Shift="{Binding Shift}" Control="{Binding Control}" Alt="{Binding Alt}" Super="{Binding Super}" />
                    </Grid>
                  </DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>
              <Button Content="{Binding Resources.String_Setting_Keyboard_Pressed_Command_AddMapping, Source={x:Static app_main:CultureService.Current}}" Command="{Binding DataContext.AddMappingCommand, ElementName=item}" />
            </StackPanel>
            <StackPanel x:Key="Common" x:Shared="False">
              <CheckBox Content="{Binding Resources.String_Setting_Keyboard_Pressed_ConveySystem_A, Source={x:Static app_main:CultureService.Current}}" IsChecked="{Binding ConveySystem}" />
              <TextBox Text="{Binding Comment}" />
              <Button Content="x" Command="{Binding Editor.RemovePressedJobCommand, ElementName=root}" CommandParameter="{Binding}" />
            </StackPanel>

            <DataTemplate DataType="{x:Type app_main_viewmodels_setting:KeyboardCommandJobSettingEditorViewModel}">
              <Expander x:Name="item">
                <Expander.Header>
                  <TextBlock Style="{StaticResource ExpanderHeaderInner}" Text="{Binding Resources.String_Setting_Keyboard_Pressed_Command_Header, Source={x:Static app_main:CultureService.Current}}" />
                </Expander.Header>
                <StackPanel>
                  <ContentControl Content="{StaticResource Mappings}" />
                  <ContentControl Content="{StaticResource Common}" />
                </StackPanel>
              </Expander>
            </DataTemplate>

            <DataTemplate DataType="{x:Type app_main_viewmodels_setting:KeyboardLauncherItemJobSettingEditorViewModel}">
              <Expander x:Name="item">
                <Expander.Header>
                  <Grid Style="{StaticResource ExpanderHeaderInner}">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" Text="{Binding Resources.String_Setting_Keyboard_Pressed_LauncherItem_Header, Source={x:Static app_main:CultureService.Current}}" />
                    <ComboBox Grid.Column="1" ItemsSource="{Binding AllLauncherItems}" SelectedItem="{Binding LauncherItem}">
                      <ComboBox.ItemsPanel>
                        <ItemsPanelTemplate>
                          <VirtualizingStackPanel
                            VirtualizingStackPanel.IsVirtualizing="True"
                            VirtualizingStackPanel.VirtualizationMode="Recycling"
                          />
                        </ItemsPanelTemplate>
                      </ComboBox.ItemsPanel>
                      <ComboBox.ItemTemplate>
                        <DataTemplate>
                          <StackPanel Orientation="Horizontal">
                            <app_main_views:ImageViewerControl IconViewer="{Binding Icon.Small}" />
                            <TextBlock Text="{Binding Common.Name}" />
                          </StackPanel>
                        </DataTemplate>
                      </ComboBox.ItemTemplate>
                    </ComboBox>
                  </Grid>
                </Expander.Header>
                <StackPanel>
                  <Grid>
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Label Grid.Column="0" Content="{Binding Resources.String_Setting_Keyboard_Pressed_LauncherItem_Execute_A, Source={x:Static app_main:CultureService.Current}}" />
                    <WrapPanel Grid.Column="1" VerticalAlignment="Center">
                      <RadioButton Content="{Binding Source={x:Static app_main_modes_data:KeyActionContentLauncherItem.Execute}, Converter={StaticResource EnumToCultureConverter}, ConverterParameter=A}" IsChecked="{Binding Content, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static app_main_modes_data:KeyActionContentLauncherItem.Execute}}" />
                      <RadioButton Content="{Binding Source={x:Static app_main_modes_data:KeyActionContentLauncherItem.ExtendsExecute}, Converter={StaticResource EnumToCultureConverter}, ConverterParameter=A}" IsChecked="{Binding Content, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter={x:Static app_main_modes_data:KeyActionContentLauncherItem.ExtendsExecute}}" />
                    </WrapPanel>
                  </Grid>
                  <ContentControl Content="{StaticResource Mappings}" />
                  <ContentControl Content="{StaticResource Common}" />
                </StackPanel>
              </Expander>
            </DataTemplate>

            <DataTemplate DataType="{x:Type app_main_viewmodels_setting:KeyboardLauncherToolbarJobSettingEditorViewModel}">
              <Expander x:Name="item">
                <Expander.Header>
                  <TextBlock Style="{StaticResource ExpanderHeaderInner}" Text="{Binding Resources.String_Setting_Keyboard_Pressed_Toolbar_Header, Source={x:Static app_main:CultureService.Current}}" />
                </Expander.Header>
                <StackPanel>
                  <ContentControl Content="{StaticResource Mappings}" />
                  <ContentControl Content="{StaticResource Common}" />
                </StackPanel>
              </Expander>
            </DataTemplate>

            <DataTemplate DataType="{x:Type app_main_viewmodels_setting:KeyboardNoteJobSettingEditorViewModel}">
              <Expander x:Name="item">
                <Expander.Header>
                  <Grid Style="{StaticResource ExpanderHeaderInner}">
                    <Grid.ColumnDefinitions>
                      <ColumnDefinition Width="Auto" />
                      <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <TextBlock Grid.Column="0" Text="{Binding Resources.String_Setting_Keyboard_Pressed_Note_Header, Source={x:Static app_main:CultureService.Current}}" />
                    <ComboBox Grid.Column="1" ItemsSource="{Binding ContentItems}" SelectedItem="{Binding Content}">
                      <ComboBox.ItemsPanel>
                        <ItemsPanelTemplate>
                          <VirtualizingStackPanel
                            VirtualizingStackPanel.IsVirtualizing="True"
                            VirtualizingStackPanel.VirtualizationMode="Recycling"
                          />
                        </ItemsPanelTemplate>
                      </ComboBox.ItemsPanel>
                      <ComboBox.ItemTemplate>
                        <DataTemplate>
                          <TextBlock Text="{Binding Converter={StaticResource EnumToCultureConverter}}" />
                        </DataTemplate>
                      </ComboBox.ItemTemplate>
                    </ComboBox>
                  </Grid>
                </Expander.Header>
                <StackPanel>
                  <ContentControl Content="{StaticResource Mappings}" />
                  <ContentControl Content="{StaticResource Common}" />
                </StackPanel>
              </Expander>
            </DataTemplate>

          </ItemsControl.Resources>
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <VirtualizingStackPanel />
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
        </ItemsControl>
      </ScrollViewer>
    </Grid>

  </Grid>
</UserControl>
