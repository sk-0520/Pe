name: Build Works

on:
  push:
    branches-ignore:
      - master
      - ci-test
      - develop
  pull_request:
    branches-ignore:
      - master
      - ci-test
      - develop

concurrency:
  group: ${{ github.ref }}
  cancel-in-progress: true

jobs:
  build:
    uses: ./.github/workflows/_build-template.yml
    with:
      MAIN_ARCHIVE: 7z
      DEFAULT_ARCHIVE: 7z
      PE_RELEASE_ARCHIVE_BASE_URL: https://example.com
      PE_RELEASE_NOTE_BASE_URL: https://example.com


  # matrix-build:
  #   name: Build

  #   strategy:
  #     matrix:
  #       PLATFORM: ["x86", "x64"]

  #   runs-on: windows-2022

  #   steps:
  #     - name: <Checkout> Repository
  #       uses: actions/checkout@v3

  #     - name: <Add> msbuild to PATH
  #       uses: microsoft/setup-msbuild@v1.1
  #       with:
  #         msbuild-architecture: x64

  #     - name: <Add> VSTest
  #       uses: darenm/Setup-VSTest@v1.2

  #     - name: <Add> Node/NPM
  #       uses: actions/setup-node@v3
  #       with:
  #         node-version-file: ./.node-version
  #         cache: npm

  #     - name: <Cache> Nuget
  #       uses: actions/cache@v3
  #       with:
  #         path: ${{ github.workspace }}/.nuget/packages
  #         key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
  #         restore-keys: |
  #           ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}

  #     - name: <Cache> Obj
  #       uses: actions/cache@v3
  #       with:
  #         path: ${{ github.workspace }}/Source/**/obj
  #         key: ${{ runner.os }}-obj-${{ matrix.PLATFORM }}-${{ hashFiles('**/*.csproj') }}
  #         restore-keys: |
  #           ${{ runner.os }}-obj-${{ matrix.PLATFORM }}-${{ hashFiles('**/*.csproj') }}

  #     - name: <Generate> Data
  #       shell: pwsh
  #       run: .\Build\generate-data-files.ps1

  #     - name: <Install> NPM
  #       run: npm ci

  #     - name: <Test> Script
  #       run: npm test

  #     - name: <Build> BuildTools
  #       shell: pwsh
  #       run: .\Build\make-buildtools.ps1

  #     - name: <Build> Document
  #       run: npm run help-ci

  #     - name: <Artifact> Document
  #       uses: actions/upload-artifact@v3
  #       with:
  #         name: Document
  #         path: Output\help

  #     - name: <Build> Application
  #       shell: pwsh
  #       run: .\Build\build.ps1 -ProductMode -IgnoreChanged -BuildType BETA -Platforms ${{ matrix.PLATFORM }}

  #     - name: <Test> Add Logger
  #       shell: cmd
  #       run: for /d %%f in (Source\Pe\*.Test) do ( cd %%f & nuget install GitHubActionsTestLogger & cd ..\..\..\ )

  #     - name: <Test> Application
  #       shell: pwsh
  #       run: .\Build\test.ps1 -MainConfigurations Release -BootConfigurations Release,CI_TEST -Platforms ${{ matrix.PLATFORM }} -Logger GitHubActions

  #     - name: <Archive> Application
  #       shell: pwsh
  #       run: .\Build\compress.ps1 -MainArchive ${{ env.MAIN_ARCHIVE }} -DefaultArchive ${{ env.DEFAULT_ARCHIVE }} -Platforms ${{ matrix.PLATFORM }}

  #     - name: <Make> update info
  #       shell: pwsh
  #       run: .\Build\create-updateinfo.ps1 -TargetRepository github -MinimumVersion ${{ env.MINIMUM_VERSION }} -ArchiveBaseUrl ${{ env.PE_RELEASE_ARCHIVE_BASE_URL }} -NoteBaseUrl ${{ env.PE_RELEASE_NOTE_BASE_URL }} -ReleaseDirectory Output -MainArchive ${{ env.MAIN_ARCHIVE }} -DefaultArchive ${{ env.DEFAULT_ARCHIVE }} -Platforms ${{ matrix.PLATFORM }}

  #     - name: <Make> release note
  #       shell: pwsh
  #       run: .\Build\create-release-note.ps1 -IgnoreEmpty

  #     - name: <Artifact> Application
  #       uses: actions/upload-artifact@v3
  #       with:
  #         name: Pe-${{ matrix.PLATFORM }}
  #         path: |
  #           Output\Pe_*.${{ env.MAIN_ARCHIVE }}
  #           Output\Pe_*.html
  #           Output\Pe_*.md
  #           Output\*-tag.json
  #           Output\update.json
  #           Output\gen-*

  #     - name: <Artifact> Pe.Plugins.Reference
  #       uses: actions/upload-artifact@v3
  #       with:
  #         name: Pe.Plugins.Reference-${{ matrix.PLATFORM }}
  #         path: |
  #           Output\Pe.Plugins.Reference.*_${{ matrix.PLATFORM }}.${{ env.DEFAULT_ARCHIVE }}
  #           Output\Pe.Plugins.Reference.*.html
  #           Output\update-Pe.Plugins.Reference.*.json

