name: Icon

on:
  schedule:
    - cron: "0 0 * * *"
  workflow_dispatch:
  push:
    branches-ignore:
      - master
      - ci-test
      - develop

jobs:
  icon:
    name: Icon
    runs-on: ubuntu-latest

    strategy:
      matrix:
        TYPE:
          - release
          - debug
          - beta
          - plugin

    steps:
      - name: <Checkout> Repository
        uses: actions/checkout@v4

      # - name: Set up docker buildx
      #   uses: docker/setup-buildx-action@v3

      - name: Delete *.ico
        shell: bash
        run: rm Resource/Icon/*.ico

      - name: Retouch
        shell: bash
        run: |
          cd Resource
          docker compose run retouch pwsh work/EntryRetouch.ps1 -mode ${{ matrix.TYPE }}

      - name: SVG -> PNG
        shell: bash
        run: |
          cd Resource
          docker compose run inkscape /bin/bash -ue /work/export-png.sh --svg /data/@data/${{ matrix.TYPE }}/App.svg --output /data/@data/${{ matrix.TYPE }}

      - name: PNG -> ICO
        shell: bash
        run: |
          cd Resource
          docker compose run --entrypoint "/bin/bash -ue /work/convert-ico.sh --input /data/@data/${{ matrix.TYPE }} --output /data/@data/${{ matrix.TYPE }}/App.ico" imagemagick

      - name: <Artifact> Icon
        uses: actions/upload-artifact@v4
        with:
          name: Retouch-${{ matrix.TYPE }}
          path: Resource/Icon
          if-no-files-found: error
